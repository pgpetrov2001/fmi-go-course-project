{{define "carousel"}}

{{ $selectedPhotos := . }}
{{ $numPhotos := len . }}

{{$initialId := 0}}
{{if gt $numPhotos 0}}
  {{$initialPhoto := index . 0}}
  {{$initialId = $initialPhoto.ID}}
{{end}}

{{if gt $numPhotos 0}}
<div class="carousel-container">
  <ul class="carousel my-carousel carousel--thumb">
    {{range .}}
      {{ $onclick := .ID | printf "document.querySelectorAll('.selected').forEach((el) => el.classList.remove('selected')); document.querySelectorAll('[data-photo-id=&quot;%d&quot;]').forEach((el) => el.classList.add('selected'))" }}
      <input
              class="carousel__activator"
              type="radio"
              id="photo-{{.ID}}"
              name="thumb"
              {{ safeHTMLAttr "onclick" $onclick }}
              {{if eq .ID $initialId}}checked="checked"{{end}}/>
    {{end}}

    {{range $i, $photo := .}}
      {{ $prevIndex := sub $i 1 }}
      {{ $prevIndex = add $prevIndex $numPhotos }}
      {{ $prevIndex = mod $prevIndex $numPhotos }}
      {{ $nextIndex := add $i 1 }}
      {{ $nextIndex = mod $nextIndex $numPhotos }}
      {{ $prevPhoto := index $selectedPhotos $prevIndex }}
      {{ $nextPhoto := index $selectedPhotos $nextIndex }}
      <div class="carousel__controls {{if eq $photo.ID $initialId}}selected{{end}}" data-photo-id="{{$photo.ID}}">
        <label class="carousel__control carousel__control--backward" for="photo-{{$prevPhoto.ID}}"></label>
        <label class="carousel__control carousel__control--forward" for="photo-{{$nextPhoto.ID}}"></label>
      </div>
    {{end}}
    {{range $i, $photo := .}}
      {{ $translateX := mul $i 100 }}
      <li
              class="carousel__slide photo {{if eq $photo.ID $initialId}}selected{{end}}"
              data-photo-id="{{$photo.ID}}"
              style="background-image: url('/img/{{$photo.ID}}');">
      </li>
    {{end}}
    <div class="carousel__indicators">
    {{range .}}
        <label
                class="carousel__indicator {{if eq .ID $initialId}}selected{{end}}"
                data-photo-id="{{.ID}}"
                for="photo-{{.ID}}"
                style="background-image: url('/img/{{.ID}}')">
        </label>
    {{end}}
    </div>
  </ul>
</div>
{{else}}
<p>No photos available at the moment.</p>
{{end}}
{{end}}